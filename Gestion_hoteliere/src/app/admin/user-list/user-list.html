<!-- src/app/admin/user-list/user-list.html -->
<div class="user-list-container">

  <!-- HEADER -->
  <mat-card class="header-card">
    <div class="header-actions">
      <div class="header-text">
        <h2>Gestion des utilisateurs</h2>
        <p>Liste des utilisateurs</p>
      </div>

      <!-- BOUTON AJOUT -->
      <button
        mat-raised-button
        color="primary"
        routerLink="/admin/users/add">
        <mat-icon>person_add</mat-icon>
        Ajouter un utilisateur
      </button>
    </div>
  </mat-card>

  <!-- TABLE CARD -->
  <mat-card class="table-card">

    <!-- LOADING -->
    <div *ngIf="loading" class="loading">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      <p class="loading-text">Chargement des utilisateurs...</p>
    </div>

    <!-- EMPTY STATE -->
    <div *ngIf="!loading && users.length === 0" class="empty-state">
      <mat-icon>people</mat-icon>
      <p>Aucun utilisateur trouvé</p>
      <button mat-button color="primary" routerLink="/admin/users/add">
        <mat-icon>person_add</mat-icon>
        Ajouter un utilisateur
      </button>
    </div>

    <!-- TABLE -->
    <div *ngIf="!loading && users.length > 0" class="table-container">
      <table mat-table [dataSource]="users" class="mat-elevation-z0">

        <!-- ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let user">{{ user.id }}</td>
        </ng-container>

        <!-- EMAIL -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let user">{{ user.email }}</td>
        </ng-container>

        <!-- NOM COMPLET -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Nom complet</th>
          <td mat-cell *matCellDef="let user">
            {{ user.firstName }} {{ user.lastName }}
          </td>
        </ng-container>

        <!-- ROLES -->
        <ng-container matColumnDef="roles">
          <th mat-header-cell *matHeaderCellDef>Rôles</th>
          <td mat-cell *matCellDef="let user">
            <span class="role-badge" *ngFor="let role of user.roles" [class]="getRoleClass(role)">
              {{ getRoleDisplayName(role) }}
            </span>
          </td>
        </ng-container>

        <!-- STATUS -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let user">
            <span [class.status-active]="user.active" [class.status-inactive]="!user.active">
              <mat-icon>{{ user.active ? 'check_circle' : 'cancel' }}</mat-icon>
              {{ user.active ? 'ACTIF' : 'INACTIF' }}
            </span>
          </td>
        </ng-container>

        <!-- ACTIONS -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let user">
            <div class="actions-container">
              <!-- MODIFIER -->
              <button 
                mat-icon-button 
                color="primary" 
                title="Modifier"
                [routerLink]="['/admin/users/edit', user.id]">
                <mat-icon>edit</mat-icon>
              </button>

              <!-- ACTIVER/DÉSACTIVER -->
              <button
                mat-icon-button
                [color]="user.active ? 'warn' : 'primary'"
                [title]="user.active ? 'Désactiver' : 'Activer'"
                (click)="toggleUserStatus(user)">
                <mat-icon>{{ user.active ? 'toggle_off' : 'toggle_on' }}</mat-icon>
              </button>

              <!-- SUPPRIMER -->
              <button
                mat-icon-button
                color="warn"
                title="Supprimer"
                (click)="deleteUser(user)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- ROWS -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </div>
  </mat-card>
</div>