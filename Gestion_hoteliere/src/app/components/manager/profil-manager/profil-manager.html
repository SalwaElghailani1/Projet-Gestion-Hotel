<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROYELLAS HOTEL - Profil</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="profile-container">
  <div class="sidebar">
    <div class="logo-section">
      <div class="logo">
        <i class="fas fa-crown"></i>
        <span>ROYELLAS <span class="hotel-name">HOTEL</span></span>
      </div>
      <p class="welcome-text">Welcome Back,</p> <div class="user-details"><h3>{{user.nom}} {{user.prenom}}</h3></div>
    </div>

    <div class="nav-menu">
      <div class="nav-item"
           [class.active]="activeSection === 'profile'"
           (click)="showSection('profile')">
        <div class="nav-icon">
          <i class="fas fa-user"></i>
        </div>
        <span class="nav-text">Profil</span>
      </div>

      <div class="nav-item"
           [class.active]="activeSection === 'Dashboard'"
           (click)="showSection('Dashboard')">
        <div class="nav-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <span class="nav-text">Dashboard</span>
      </div>

      <div class="nav-item"
           [class.active]="activeSection === 'rooms'"
           (click)="showSection('rooms')">
        <div class="nav-icon">
          <i class="fas fa-bed"></i>
        </div>
        <span class="nav-text">Rooms</span>
      </div>

      <div class="nav-item"
           [class.active]="activeSection === 'services'"
           (click)="showSection('services')">
        <div class="nav-icon">
          <i class="fas fa-users"></i>
        </div>
        <span class="nav-text">internal services</span>
      </div>

      <div class="nav-item"
           [class.active]="activeSection === 'settings'"
           (click)="showSection('settings')">
        <div class="nav-icon">
          <i class="fas fa-cog"></i>
        </div>
        <span class="nav-text">Settings</span>
      </div>

      <div class="nav-item"
           [class.active]="activeSection === 'contact'"
           (click)="showSection('contact')">
        <div class="nav-icon">
          <i class="fas fa-phone"></i>
        </div>
        <span class="nav-text">Contact Us</span>
      </div>

      <div class="nav-item"
           [class.active]="activeSection === 'report'"
           (click)="showSection('report')">
        <div class="nav-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <span class="nav-text">Report</span>
      </div>
    </div>

    <div class="sidebar-footer">

      <div class="sidebar-actions">
        <button class="nav-btn logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Disconnect</span>
        </button>
        <button class="nav-btn delete-btn" (click)="deleteAccount()">
          <i class="fas fa-trash-alt"></i>
          <span>DELETE</span>
        </button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Profile Section -->
    <div class="content-section profile-edit" *ngIf="activeSection === 'profile'">
      <div class="page-header">
        <h1><i class="fas fa-user-edit"></i> Edit Profile</h1>
        <p class="page-subtitle">Update your personal information</p>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="profile-form">
        <div class="form-header">
          <div class="form-avatar-section">
            <div class="avatar-info">
              <h3>{{user.nom}} {{user.prenom}}</h3>
              <p>{{profileForm.get('email')?.value}}</p>
              <p>
                You are the manager. You can view the dashboard, manage rooms by creating,
                editing or deleting them, and oversee all internal hotel services.
              </p>
            </div>
          </div>
        </div>

        <div class="form-content">
          <div class="form-section">
            <h3><i class="fas fa-id-card"></i> Personal Information</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="nom">Last Name *</label>
                <input type="text" id="nom" formControlName="nom" placeholder="Your Last Name" readonly>
              </div>

              <div class="form-group">
                <label for="prenom">First Name *</label>
                <input type="text" id="prenom" formControlName="prenom" placeholder="Your First Name" readonly>
              </div>

              <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" formControlName="email" placeholder="Your Email" readonly>
              </div>

              <div class="form-group">
                <label for="telephone">Phone *</label>
                <input type="tel" id="telephone" formControlName="telephone" placeholder="+212 XX XX XX XX">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3><i class="fas fa-info-circle"></i> Additional Information</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="dateNaissance">Date of Birth *</label>
                <input type="date" id="dateNaissance" formControlName="dateNaissance">
              </div>

              <div class="form-group">
                <label for="cin">National ID *</label>
                <input type="text" id="cin" formControlName="cin" placeholder="Your ID Number">
              </div>

              <div class="form-group">
                <label for="adresse">Address *</label>
                <input type="text" id="adresse" formControlName="adresse" placeholder="Your Address">
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="cancelEdit()">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn-primary">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="content-section" *ngIf="activeSection==='Dashboard'">

      <div class="page-header">
        <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
      </div>

      <!-- ===== STATS CARDS ===== -->
      <div class="stats-cards">
        <div class="stat-card">
          <h3>Total Internal Services</h3>
          <p>{{ internalUsers.length }}</p>
        </div>

        <div class="stat-card">
          <h3>Total Rooms</h3>
          <p>{{ rooms.length }}</p>
        </div>

        <div class="stat-card">
          <h3>Reservations</h3>
          <p>{{ reservations.length }}</p>

        </div>

        <div class="stat-card">
          <h3>Income</h3>
          <p>{{ totalIncome | number:'1.0-0' }} MAD</p>
        </div>
      </div>

      <!-- ===== DIAGRAMMES ===== -->
      <div class="charts-grid">

        <!-- Bar Chart -->
        <!-- Reservations Chart -->
        <div class="chart-card">
          <h3>Reservations per month</h3>

          <div *ngIf="reservationsByMonth && reservationsByMonth.length > 0;">
            <div class="bar-chart">
              <div class="bar" *ngFor="let item of reservationsByMonth">
                <!-- Barre avec valeur -->
                <div class="bar-fill"
                     [ngClass]="{'empty-bar': item.count === 0}"
                     [style.height.%]="getBarHeight(item.count)">
                  <!-- Affichage de la valeur au survol -->
                  <div class="bar-value">{{ item.count }}</div>
                </div>
                <span>{{ item.month }}</span>
              </div>
            </div>

            <!-- Légende -->
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color" style="background: linear-gradient(180deg, #6a11cb, #2575fc);"></span>
              </div>
            </div>
          </div>
        </div>


        <!-- Progress Chart -->
        <div class="chart-card">
          <h3>Room Occupancy Rates</h3>

          <div class="progress-item">
            <span>Occupied Rooms</span>
            <div class="progress-bar">
              <div class="progress-fill occupied" [style.width.%]="getRoomStatusPercentage('Occupée')"></div>
            </div>
            <strong>{{ getRoomStatusPercentage('Occupée') }}%</strong>
          </div>

          <div class="progress-item">
            <span>Available Rooms</span>
            <div class="progress-bar">
              <div class="progress-fill available" [style.width.%]="getRoomStatusPercentage('Disponible')"></div>
            </div>
            <strong>{{ getRoomStatusPercentage('Disponible') }}%</strong>
          </div>

          <div class="progress-item">
            <span>Maintenance</span>
            <div class="progress-bar">
              <div class="progress-fill maintenance" [style.width.%]="getRoomStatusPercentage('Maintenance')"></div>
            </div>
            <strong>{{ getRoomStatusPercentage('Maintenance') }}%</strong>
          </div>
        </div>


      </div>
    </div>

    <div class="content-section" *ngIf="activeSection==='rooms'">

      <div class="page-header">
        <h1><i class="fas fa-bed"></i> Rooms</h1>
        <button class="btn-sm create-room" (click)="openCreateRoomModal()">Create Room</button>
      </div>

      <!-- ===== ROOMS TABLE ===== -->
      <div class="rooms-table">
        <table>
          <thead>
          <tr>
            <th>Number</th>
            <th>Type</th>
            <th>Price</th>
            <th>Status</th>
            <th>Description</th>
            <th>Images</th>
            <th>Rate</th>
            <th>Bed (L x W)</th>
            <th>Action</th>
          </tr>

          </thead>
          <tbody>
          <tr *ngFor="let room of rooms">
            <td>{{ room.numero }}</td>
            <td>{{ room.type }}</td>
            <td>{{ room.prix }} MAD</td>
            <td>
          <span class="status" [ngClass]="{
            'available': room.etat === 'Disponible',
            'occupied': room.etat === 'Occupée',
            'maintenance': room.etat === 'Maintenance'
          }">
            {{ room.etat }}
          </span>
            </td>
            <td>{{ room.description }}</td>
            <td>
              <img [src]="'http://localhost:8093/uploads/' + room.image" alt="Room image" />
            </td>
            <td>{{ room.taux }} %</td>
            <td>{{ room.lit_long }} x {{ room.lit_large }} cm</td>
            <td>
              <button class="btn-sm edit" (click)="editRoom(room)">Edit</button>
              <button class="btn-sm delete" (click)="deleteRoom(room.id)">DELETE</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>


    <!-- ===== CREATE ROOM MODAL ===== -->
    <div class="modal" *ngIf="createRoomModalOpen">
      <div class="modal-overlay" (click)="closeCreateRoomModal()"></div>
      <div class="modal-content">
        <span class="close" (click)="closeCreateRoomModal()">&times;</span>
        <h2>{{ isEditMode ? 'Edit Room' : 'Create New Room' }}</h2>

        <form (ngSubmit)="submitRoom()">

          <!-- Basic info -->
          <input [(ngModel)]="selectedRoom.numero" name="numero" placeholder="Room Number" required>

          <select [(ngModel)]="selectedRoom.type" name="type" required>
            <option>Single</option>
            <option>Double</option>
            <option>Suite</option>
          </select>

          <input type="number"
                 [(ngModel)]="selectedRoom.prix"
                 name="prix"
                 placeholder="Price (MAD)"
                 required>

          <select [(ngModel)]="selectedRoom.etat" name="etat" required>
            <option>Disponible</option>
            <option>Occupée</option>
            <option>Maintenance</option>
          </select>

          <!-- Additional fields -->
          <textarea [(ngModel)]="selectedRoom.description"
                    name="description"
                    placeholder="Description"></textarea>

          <input type="number"
                 [(ngModel)]="selectedRoom.taux"
                 name="taux"
                 placeholder="Rate (%)">

          <input type="number"
                 [(ngModel)]="selectedRoom.lit_long"
                 name="lit_long"
                 placeholder="Bed Length (cm)">

          <input type="number"
                 [(ngModel)]="selectedRoom.lit_large"
                 name="lit_large"
                 placeholder="Bed Width (cm)">

          <!-- Image -->
          <label>Room Image</label>
          <input type="file" (change)="onImageSelected($event)" accept="image/*">

          <div *ngIf="imagePreview">
            <p>Preview:</p>
            <img [src]="imagePreview"
                 alt="Room Image"
                 style="max-width:200px; max-height:150px;">
          </div>

          <button type="submit" class="btn-sm create-room">
            {{ isEditMode ? 'Update' : 'Create' }}
          </button>

        </form>
      </div>
    </div>


    <div class="content-section" *ngIf="activeSection === 'services'">

      <div class="page-header">
        <h1><i class="fas fa-users"></i> Internal Services</h1>
        <p class="page-subtitle">List of employees and their status (on_work or out_work)</p>
      </div>

      <div class="internal-services-table">
        <table>
          <thead>
          <tr>
            <th>Last Name</th>
            <th>First Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let user of internalUsers">
            <td>{{ user.nom }}</td>
            <td>{{ user.prenom }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.metierRole }}</td>
            <td>
              <span [ngClass]="{
                    'status-onwork': user.status === 'ON_WORK',
                    'status-outwork': user.status === 'OUT_WORK',
                    'status-draft': user.status === 'DRAFT'
                  }">
                {{ user.status }}
              </span>
            </td>


          </tr>
          </tbody>
        </table>
      </div>

    </div>

    <!-- Settings Section -->
    <div class="content-section" *ngIf="activeSection === 'settings'">
      <div class="page-header">
        <h1><i class="fas fa-cog"></i> Settings</h1>
      </div>

      <div class="settings-container">
        <div class="settings-section">
          <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
          <div class="settings-options">
            <div class="setting-item">
              <div class="setting-info">
                <h4>Email Notifications</h4>
                <p>Receive important notifications by email</p>
              </div>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="settings.emailNotifications">
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <h4>SMS Notifications</h4>
                <p>Receive important alerts via SMS</p>
              </div>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="settings.smsNotifications">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h2><i class="fas fa-globe"></i> Language and Region</h2>
          <div class="form-group">
            <label for="language">Languge</label>
            <select id="language" [(ngModel)]="settings.language" class="language-select">
              <option value="fr">Français</option>
              <option value="en">English</option>
              <option value="ar">العربية</option>
            </select>
          </div>
        </div>

        <div class="settings-section">
          <h2><i class="fas fa-lock"></i> Confidentiality</h2>
          <div class="settings-options">
            <div class="setting-item">
              <div class="setting-info">
                <h4>Public Profile</h4>
                <p>Make your profile visible to other users</p>
              </div>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="settings.publicProfile">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Section -->
    <div class="content-section" *ngIf="activeSection === 'contact'">
      <div class="page-header">
        <h1><i class="fas fa-phone"></i> Contact</h1>
      </div>

      <div class="contact-container">
        <div class="contact-info-section">
          <h2><i class="fas fa-info-circle"></i> Contact Information</h2>
          <div class="contact-cards">
            <div class="contact-card">
              <div class="contact-icon">
                <i class="fas fa-envelope"></i>
              </div>
              <div class="contact-content">
                <h3>Email</h3>
                <p>contact@royellashotel.com</p>
                <small>Response within 24 hours</small>
              </div>
            </div>

            <div class="contact-card">
              <div class="contact-icon">
                <i class="fas fa-phone"></i>
              </div>
              <div class="contact-content">
                <h3>Phone</h3>
                <p>+212 5 XX XX XX XX</p>
                <small>Lun-Ven: 9h-18h</small>
              </div>
            </div>

            <div class="contact-card">
              <div class="contact-icon">
                <i class="fas fa-map-marker-alt"></i>
              </div>
              <div class="contact-content">
                <h3>Address</h3>
                <p>123 Avenue Mohammed V, Casablanca, Morocco</p>
                <small>Visits by appointment only</small>
              </div>
            </div>
          </div>
        </div>

        <div class="contact-form-section">
          <h2><i class="fas fa-paper-plane"></i> Send a message</h2>
          <div class="contact-form">
            <div class="form-group">
              <label for="contactSubject">Subject</label>
              <input type="text" id="contactSubject" placeholder="Subject of your message">
            </div>
            <div class="form-group">
              <label for="contactMessage">Message</label>
              <textarea id="contactMessage" [(ngModel)]="contactMessage"
                        placeholder="Your message..." rows="6"></textarea>
            </div>
            <button class="btn-primary send-btn" (click)="sendMessage()">
              <i class="fas fa-paper-plane"></i> Send Message
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Section -->
    <div class="content-section" *ngIf="activeSection === 'report'">
      <div class="page-header">
        <h1><i class="fas fa-exclamation-triangle"></i> Report a Problem</h1>
      </div>

      <div class="report-container">
        <div class="report-form">
          <div class="form-section">
            <h3><i class="fas fa-clipboard-list"></i> Problem Details</h3>
            <div class="form-group">
              <label for="reportType">Type of problem</label>
              <select id="reportType" [(ngModel)]="report.type">
                <option value="technical">Technical problem</option>
                <option value="bug">Bug</option>
                <option value="suggestion">Suggestion</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="reportSubject">Subject</label>
              <input type="text" id="reportSubject" [(ngModel)]="report.subject"
                     placeholder="Briefly describe the problem">
            </div>

            <div class="form-group">
              <label for="reportDescription">Detailed description</label>
              <textarea id="reportDescription" [(ngModel)]="report.description"
                        placeholder="Describe the problem in detail..."
                        rows="6"></textarea>
            </div>

            <div class="form-group">
              <label for="reportScreenshot">Screenshot (optional)</label>
              <div class="file-upload">
                <label for="reportScreenshot" class="file-upload-label">
                  <i class="fas fa-cloud-upload-alt"></i>
                  <span>Choose a file</span>
                </label>
                <input id="reportScreenshot" type="file"
                       (change)="onScreenshotSelected($event)"
                       accept="image/*" hidden>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button class="btn-primary">
              <i class="fas fa-paper-plane"></i> Send the Report
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Confirmation Modal -->
<div class="modal" *ngIf="showModal">
  <div class="modal-content">
    <div class="modal-icon">
      <i class="fas fa-exclamation-circle"></i>
    </div>
    <h2>Confirmation</h2>
    <p>{{modalMessage}}</p>
    <div class="modal-actions">
      <button class="btn-secondary" (click)="showModal = false">
        <i class="fas fa-times"></i> Cancel
      </button>
      <button class="btn-danger" (click)="confirmAction()">
        <i class="fas fa-check"></i> Confirme
      </button>
    </div>
  </div>
</div>
</body>
</html>
